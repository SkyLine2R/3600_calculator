<!DOCTYPE html>
<html lang="ru">

<head>
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,700&display=swap&subset=cyrillic" rel="stylesheet" />

</head>

<body>
  <div class="promo">
    <title>3600 калькулятор</title>
    <h1>Калькулятор дней по акции 3600</h1>
    <p class="promo-text">В диалоговых окнах необходимо ввести актуальные суммы тарифов и текущий баланс абонента. Если
      услуга не
      предоставляется - оставить "0" или нажать "отмена". <br>
      Калькулятор считает сумму списываемую до 1.01.2023 со скидкой 50% (кроме реального IP). <br> Остаток средств
      считает
      по
      стандартному тарифу. </p>
    <button class="button button-cart" id="cart-button">
      <span class="button-cart-svg"></span>
      <span class="button-text">Калькулятор 3600</span>
    </button>
    <a class="button" type="js">Запуск калькулятора</a>

    <div>
      <h3>Результаты расчётов:</h3>
      <div id="calc-result"></div>
    </div>

  </div>

  <script>
    'use strict'

    let calcResult = document.getElementById('calc-result')

    document.querySelector('a').onclick = function () {
      calc3600();
    }


    //аналогично
    /*     document.querySelector('p').onclick = function () {
          alert('Ouch! Stop poking me!');
        }  //аналогично
     */
    /* var myHTML = document.querySelector('html');
      myHTML.onclick = function () { };
 */
    /*   var myHeading = document.querySelector('h1');
      myHeading.textContent = 'Hello world!'; */

    /*   var myImage = document.querySelector('img');
    
      myImage.onclick = function () {
        var mySrc = myImage.getAttribute('src');
        if (mySrc === 'images/firefox-icon.png') {
          myImage.setAttribute('src', 'images/firefox2.png');
        } else {
          myImage.setAttribute('src', 'images/firefox-icon.png');
        }
      }
     */
    //calc3600()

    function calc3600() {
      const stopDate = new Date(2022, 11, 31);
      let tarif = 0;


      const inpAndTest = (str, defVal) => {
        let a = prompt(str, defVal) || 0;
        a = a ? a.match(/\d+/) : 0;
        return a ? a : defVal
      }

      while (tarif <= 0) {
        tarif = inpAndTest('Введите текущий тариф абонента за пакет ТВ/Интернет или ТВ+Интернет', 0)

      }

      const dopuslugiIptv = inpAndTest('Введите текущий тариф абонента за допуслугу IPTV (если есть)', 0);

      const dopuslugiRealIp = inpAndTest('Введите текущий тариф абонента за допуслугу реального IP (если есть)', 0);

      let balans = +prompt('Введите текущий баланс абонента', 0) + 0 || 0;

      const balansOld = balans;
      balans += 3600;

      let thisYearLeftDay = Math.ceil((stopDate - Date.now()) / 1000 / 60 / 60 / 24)
      let thisYearLeftMonth = (new Date(stopDate - Date.now())).getMonth()

      const tarif50 = Math.ceil(tarif / 2)
      const dopuslugiIptv50 = Math.ceil(dopuslugiIptv / 2)


      //списываем деньги до конца года за все услуги по новому тарифу
      const balans2022 =
        balans -= (tarif50 / 30 + dopuslugiIptv50 / 30) * thisYearLeftDay + dopuslugiRealIp * thisYearLeftMonth;


      //на сколько дней хватит оставшейся суммы по старому тарифу
      let daysAfter22 = 0;
      let monthAfter22 = -1;

      while (balans > 0) {

        daysAfter22 += 1;

        if (monthAfter22 <  //списание за реал IP помесячно
          ((new Date(+stopDate + (daysAfter22 * 24 * 3600 * 1000))).getMonth())) {
          balans -= dopuslugiRealIp;
          monthAfter22 += 1;
        }
        balans -= tarif / 30 + dopuslugiIptv / 30
      }

      let formatter1 = new Intl.DateTimeFormat("ru")

      function addTag(tag, str) {
        return `<${tag}>${str}</${tag}>`
      }

      let stringHtml = addTag('p', `Текущий тариф ${tarif} грн/30 дней`)
        .concat((dopuslugiIptv != 0 || dopuslugiRealIp != 0) ? addTag('h4', 'Дополнительные слуги:') : '')
        .concat((dopuslugiIptv != 0) ? addTag('p', `<b>IPTV:</b> ${dopuslugiIptv} грн/30 дней`) : '')
        .concat((dopuslugiRealIp != 0) ? addTag('p', `<b>Real IP:</b> ${dopuslugiRealIp} грн / мес`) : '')
        .concat(addTag('p', `Текущий баланс ${balansOld} грн.`))
        .concat(addTag('h3', 'После оплаты на счёт 3600 грн.:'))
        .concat(addTag('p', `Тариф ${tarif50} грн / 30 дней`))
        .concat((dopuslugiIptv50 != 0 || dopuslugiRealIp != 0) ? addTag('h4', 'Дополнительные слуги:') : '')
        .concat((dopuslugiIptv50 != 0) ? addTag('p', `<b>IPTV:</b> ${dopuslugiIptv50} грн/30 дней`) : '')
        .concat((dopuslugiRealIp != 0) ? addTag('p', `<b>Real IP:</b> ${dopuslugiRealIp} грн / мес`) : '')
        .concat(addTag('p', `Cпишется ${Math.round(balansOld + 3600 - balans2022)} грн.за ${thisYearLeftDay} дней до конца 2022 года. Остаток баланса в конце года: <b> ${Math.round(balans2022)} грн.</b>`))
        .concat(addTag('p', `При текущем тарифе этой суммы хватит ещё на <b> ${daysAfter22} </b> дней до <b>${formatter1.format((new Date(stopDate.getTime() + (daysAfter22 * 24 * 3600 * 1000))))}</b>`))
        .concat(addTag('p', `Всего услуга будет работать ${thisYearLeftDay + daysAfter22} дней.`))

      calcResult.innerHTML = stringHtml;

    }

  </script>
</body>
<footer>

</footer>


</html>
